from keras_preprocessing.image.image_data_generator import ImageDataGenerator


def get_flow_from_directory(
    train_dir='data/arimgs/train',
    val_dir='data/arimgs/val',
    classes=['nothing', 'other', 'close', 'left', 'right', 'ok'],
    train_batch_size=32,
    val_batch_size=32,
    train_rotation_range=3,
    train_width_shift_range=0.05,
    train_height_shift_range=0.05,
    train_brightness_range=[0.7, 1.3],
    train_shear_range=3,
    train_zoom_range=[0.8, 1.0],
    class_mode='categorical',
    preprocess_fn=None,
):
    train_datagen = ImageDataGenerator(
        featurewise_center=False,
        samplewise_center=False,
        featurewise_std_normalization=False,
        samplewise_std_normalization=False,
        zca_whitening=False,
        zca_epsilon=1e-6,
        rotation_range=train_rotation_range,
        width_shift_range=train_width_shift_range,
        height_shift_range=train_height_shift_range,
        brightness_range=train_brightness_range,
        shear_range=train_shear_range,
        zoom_range=train_zoom_range,
        channel_shift_range=0.,
        fill_mode='nearest',
        cval=0.,
        horizontal_flip=False,
        vertical_flip=False,
        rescale=None,
        preprocessing_function=preprocess_fn,
        data_format='channels_last',
        validation_split=None,
        interpolation_order=1,
        dtype='float',
    )
    train_generator = train_datagen.flow_from_directory(
        train_dir,
        target_size=(224, 224),
        color_mode='rgb',
        classes=classes,
        class_mode=class_mode,
        batch_size=train_batch_size,
        shuffle=True,
        seed=None,
        save_to_dir=None,
        save_prefix='',
        save_format='png',
        follow_links=False,
        subset=None,
        interpolation='nearest')

    val_datagen = ImageDataGenerator(
        featurewise_center=False,
        samplewise_center=False,
        featurewise_std_normalization=False,
        samplewise_std_normalization=False,
        zca_whitening=False,
        zca_epsilon=1e-6,
        rotation_range=0,
        width_shift_range=0.,
        height_shift_range=0.,
        brightness_range=None,
        shear_range=0,
        zoom_range=0,
        channel_shift_range=0.,
        fill_mode='nearest',
        cval=0.,
        horizontal_flip=False,
        vertical_flip=False,
        rescale=None,
        preprocessing_function=preprocess_fn,
        data_format='channels_last',
        validation_split=None,
        interpolation_order=1,
        dtype='float',
    )
    val_generator = val_datagen.flow_from_directory(val_dir,
                                                    target_size=(224, 224),
                                                    color_mode='rgb',
                                                    classes=classes,
                                                    class_mode=class_mode,
                                                    batch_size=val_batch_size,
                                                    shuffle=True,
                                                    seed=None,
                                                    save_to_dir=None,
                                                    save_prefix='',
                                                    save_format='png',
                                                    follow_links=False,
                                                    subset=None,
                                                    interpolation='nearest')
    return train_generator, val_generator
